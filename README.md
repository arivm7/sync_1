# Скрипт для персональной синхронизации.
Испольтзует rsync через ssh.

Не для совместной работы. 
Проблема совместной работы заключается в том, 
что синхронизация происходит по даже изменения файлов. 
Если над одним файлом работали в двух местах то сохраниься толькол тот, который изменяли позже.

## Суть работы

Где-то на удаленном компьютере, NASе с поддержкой ssh или на корпоративном сервере, есть место, к которому есть доступ по ssh-протоколу с установленными ключами, чтобы доступ был без пароля.

На одном компьютере есть папака на диске, которая просто синхронизируется с помощью RSYNC с папкой на сервере.
На другом компьютере есть такая-же папака для которой запускается rsync для её синхронизации с папакой на сервере.
Комманда синхронизации устанавливается в crontab и просиходит автоматически по указанному в crontab расписанию.
При этом получается что все папки полностью одинаковы.

По сути работы -- это всё.

## Далее детали.

При такой конфигурации системы не возможно удалить файл, поскольку при следующей итерации синхронизаии он восстановится с сервера.
Для этого на компе где я хочу удалить файл (перенести в другую папку), я должен запустить rsync с параметрами, чтобы все разночтения были удалены с сервера.
На самом сервера ставится метка для клиентских компов о том, что им нужно считать синхронизацию так, чтобы считать всё с сервера и удалить различия у себя.
Эта процедура происходит один раз, за тем происходит обычная синхронизация папок.

Что-бы устанавливать статус синхронизацити для клиентов, на сервер пришлось ввести список "клиентов" с установлением для них статуса.
т.е. если к папаке синхронизации подключено несколько компов, то при отправке на сервер комманды на удаление файлов для всех клиентов 
устанавливается статус взять с сервера и удалить у себя, после чего для этого клиента устанавливается статус регулярных синхронизаций.
При этом, если какой-то клиент подключится через неделю, то он всё равно получит комманду обновить свои данные так, чтобы взять всё с сервера и различия у себя удалить.

Программа предствавляет собой один shell скрипт, использующий rsync b ssh.

## Назначение скриптов

[sync_1.sh] --- Собственно это и есть скрипт синхронизации. 
>>              Для работы достатоно его одного. 
>>              Все действия по синхронизации делает именно этот скрипт, 
>>              все другие -- просто вспомогательные.

[sync_1_aliases.sh] --- это скрипт алиасов и автодополнений для включения в конфиг-файл консоли. 
>>              Он включается инсталятором или в ручную в .bashrc как include 
>>              обычно так: ". /path/sync_1_aliases.sh"
>>              Алиасы заменяю длинное назване скрипта [sync_1.sh] на короткое [s1]

[sync_all.sh]       --- Пример скрипта для массовой синхронизации нескольких папок. 

[sync_install.sh]   --- Установочный скрипт. 

>> 1. Копирует скрипты [sync_1.sh] [sync_1_aliases.sh] [sync_all.sh] в папку $HOME/bin
>> 2. Копирует иконки в папаку иконок $HOME/bin/icons
>> 3. Копирует .desktop-файлы в папаку для десктоп-файлов $HOME/bin
>> 4. Внутри .desktop-файлов исправляет пути к иконкам, исполяемым скриптам и текущий путь
>> 5. Добавляет include вставку скрипта [sync_1_aliases.sh] в .bashrc файл


## Как работают режимы синхронизации:

[UP]       -- Отправить файлы с локального компьюбтера на сервер дез удаления

[DL]       -- Считать файлы с сервера на локальный компьютер без удаления

[REGULAR]  -- два прохода:
>>            1. [UP] - отправляются данные с локального компа на серве без удаления, 
>>            2. [DL] - считываются файлы с сервера на локальный компьютер без удаления
>>            **Риск**: если на компьютерах одновременно работаеют с одними и тем-же файлами, 
>>            то сохранятся только файлы дата изменения которых будет более новая, 
>>            а остальные перепишутся.
>>            За этим нужно следить самостоятельно.

[UP_INIT] -- Отправляютс яфайлы с локального компьютера на сервер с удалением расхождений на срвере
>>            После выполнения для всех килентов устанавливается статус [DL_INIT],
>>            кроме локального, с которого была выполнена команда, для него устанавливается статус REGULAR
            
[DL_INIT] -- Считываются данные с сервера на локальный компьюбтер 
>>            с ударением расходждений на локальном компьютере
>>            Если эта комманда выполняется по требованию сервера, 
>>            т.е. была установлена на сервере а не запущена в ручную, 
>>            то на сервере для этого клиента устанавливается статус [REGULAR]
            
[PAUSE]    -- Устанавливает статус сервера на "паузу". При этом синхронизация не происходит. 
>>            Это нужно для того, чтобы на саомм сервере подправить файлы 
>>            без вмешательства со стороны клиентов.
            
[UP_EDIT]  -- Когад на серере стоит статус [PAUSE], то эта комманда работает как [UP_INIT] 
>>            для изменения файлов на сервере при отклюенной синхронизации
            
[UNPAUSE]  -- снимает с сервер с паузы и устанавливает ля всех клиентов статус [DL_INIT]
>>            для полной синхронизациии с сервером.

## Техническая реализация

В папаке на компьютере которую нужно синхронизировать нужно создать папаку [.sync]
Внутри неё должны быть следующие файлы:
    [dest] -- внутри путь к папке на сервере вида [user@server:/path/to/folder/sync_folder]
    [excludes] -- файл со списком исключений для синхронизации поддерживаетмый rsync
Там-же будут созданы лог-файл [log_sync], временая папка для работы синхронизатора, 
и фал имени устройства вида [USER_<hostname>] внутри со статусом этого устройства, считанным с сервера.


